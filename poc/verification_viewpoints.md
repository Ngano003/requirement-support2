# Alloyによる追加検証観点リスト

現在の単純な状態遷移モデルに加え、ドキュメントから読み取れる以下の観点での検証が有効です。

## 1. 交差点排他制御 (Traffic Control / Mutual Exclusion)
- **参照元**: `02_agv_communication.md` (3.2. 交差点・排他制御フロー)
- **概要**: 複数のAGV（ `sig AGV` ）をモデル内に定義し、共通リソースである交差点（ `sig Resource` ）へのアクセスを検証します。
- **検証プロパティ (Assert)**:
  - **Mutual Exclusion (Safety)**: 「同一時刻に、ある交差点リソースを保持（Grant）しているAGVは高々1台であること」。
  - **No Starvation (Liveness)**: 「リソース要求（Request）を出したAGVは、最終的に必ずリソースを獲得（Grant）できること」。

## 2. 状態不変条件 (State Invariants)
- **参照元**: `01_agv_core_logic.md` (各遷移条件の `条件` 欄)
- **概要**: 各状態において、常に維持されていなければならない変数の整合性を検証します。
- **検証プロパティ (Assert)**:
  - **バッテリー制約**: `State = Moving` の時、常に `SOC > 20%` であること。もし `SOC <= 20%` なのに `Moving` に留まるパスがあれば仕様違反です。
  - **速度制約**: `02_agv_communication.md` の交差点制御において、分岐時は `Speed <= 0.3m/s` です。分岐動作中に速度超過していないか検証可能です。

## 3. ガード条件の「隙間」検出 (Guard Coverage)
- **参照元**: `01_agv_core_logic.md`
- **概要**: 数値的な閾値（バッテリー残量やタイマー）によって遷移が決まる場合、定義されていない「空白地帯」がないか検証します。
- **具体例**:
  - バッテリー残量 (SOC) について：
    - `SOC > 20`: Moving可
    - `SOC < 15`: SafeMode (条件: WiFi断 かつ)
    - **隙間**: `15 <= SOC <= 20` の時、かつWiFiがつながっている場合、AGVは正しく `idle` -> `Charging` へ移行できるか？あるいは動き続けようとしてスタックしないか？

## 4. プロトコル順序の整合性 (Protocol Sequence)
- **参照元**: `02_agv_communication.md` (連携シーケンス)
- **概要**: メッセージの送受信順序が守られているか検証します。
- **検証プロパティ**:
  - `Unloading` (荷下ろし) は必ず `Loading` (荷積み) の後に発生する。（空荷で荷下ろし動作をしていないか）
  - `Grant` (交差点進入許可) は必ず `Request` の後に発行される。
