# 要件定義書レビュー結果レポート

**実施日時**: 2026-01-18 23:28:48
**総検出数**: 21件

## 1. 全体サマリー
分析対象の 22 件すべてが他の欠陥と機能的・設計的に結びついていることが判明した。主な問題は、(1) 状態遷移表の抜け漏れによる Dead‑End と Orphan State、(2) 環境・運用制約の例外処理未記載、(3) 安全機構の復帰フロー不在の３つのパターンに集約できる。根本原因は要件定義段階で「状態遷移の完全性チェック」や「例外ハンドリングの網羅性確認」が実施されていないことである。各グループごとに提案した推奨アクションを実施し、状態遷移表・制約ハンドリング・安全復帰ロジックを統一的に見直すことで、欠陥の根本的な解消と、後続の設計・テスト工程での再発防止が期待できる。

## 2. 観点別検出状況
| 観点 | 検出数 |
|---|---|
| 1 Dead Ends | 9 |
| 2 Missing Else | 11 |
| 3 Orphan States | 1 |

## 3. 主要な欠陥グループ (根本原因分析)

### グループ 1
- **根本原因**: 状態遷移表が不完全で、タイムアウト・エラー・充電完了・待機などの状態から次に遷移すべき先が規定されていない。設計段階で ‘出口’ が定義されず、Dead‑End 状態が多数残っている。
- **推奨対策**: 全状態遷移を網羅したマトリクスを作成し、
・タイムアウト時のフォールバック（例: Error → Recovering → 前状態）
・充電完了後の復帰先（Idle/Running）
・エラー手動復帰後の遷移先
・ChargeQueue 待機のタイムアウト処理
・Shutdown からの再起動手順
を明示する。各遷移に伴う LED/ブザー・通知も併記し、レビュー・テストケースで検証すること。
- **関連する指摘ID**: chk_12, chk_14, chk_15, chk_24, chk_26, chk_30, chk_33

### グループ 2
- **根本原因**: Diagnostic モードおよび TestStandby モードへの入口が要件書に記載されていない。特殊モードは “孤立状態 (Orphan State)” となり、運用時に起動できないリスクがある。
- **推奨対策**: モード遷移トリガを明確化する。
・Diagnostic: オペレータコマンド、スケジュールタスク、またはエラーハンドリングからの自動遷移条件を記述。
・TestStandby: 物理スイッチ、遠隔コマンド、またはメンテナンスモードからの遷移手順を追加。
これらを状態遷移表 (3.2.x) に組み込み、UI/通信インタフェース仕様書でも対応する API/シーケンスを示す。
- **関連する指摘ID**: chk_31, chk_32, chk_010, chk_1

### グループ 3
- **根本原因**: 環境・運用制約（台数上限、温度・湿度範囲、連続稼働時間）に対する例外処理が欠如している。制約違反時の動作が全く示されていないため、Missing‑Else の欠陥となっている。
- **推奨対策**: 各制約に対するハンドリングを規定する。
・AGV 台数超過 → エラーコード E200、受け付け拒否、警告 LED/ブザー。
・温度/湿度範囲外 → 予防的警告 → 必要に応じて安全停止 → エラーコード。
・連続稼働超過 → 強制停止 → 休止モードへ遷移 → エラーコード。
これらを「制約事項」セクションに加え、エラーコード一覧に対応コードを追加し、テストケースで検証する。
- **関連する指摘ID**: chk_1, chk_5, chk_6, chk_8

### グループ 4
- **根本原因**: 安全機構（磁気テープ逸脱、側方障害物、リフト動作、モーター温度、タスクキャンセル）で検知後の復帰手順や状態遷移が未定義。検知＝停止だけで、再開・エラー・オペレータ通知等が抜け落ちている。
- **推奨対策**: 安全イベントごとに次の項目を追加する。
1. 停止後の遷移先（例: Obstacle → Recovering → Idle）。
2. オペレータ通知手段（LED/ブザー/通信）。
3. 再試行ロジックまたは手動復帰手順。
4. 例外シナリオ（リフト上昇中の障害物 → エラーコード E030 → Recovering）。
これらを状態遷移表に組み込み、対応する制御ロジックとテストシナリオを作成する。
- **関連する指摘ID**: chk_002, chk_003, chk_004, chk_005, chk_006, chk_008

## 4. 検出された詳細欠陥リスト

### 1 Dead Ends

#### [chk_12] タイムアウト時: 60秒以内に積載が完了しない場合、ブザーを...
- **理由**: 積載中からの遷移先が記載されておらず、状態から抜け出す手段が示されていない（Dead End）。
- **詳細分析**: 指摘は正当です。『3.2.3 積載中 (Loading) からの遷移』では、積載完了時と過積載時の遷移は定義されているものの、タイムアウト時の記述は「ブザーを鳴らしてオペレータに通知する」だけで、次の状態へ遷移する手段（例: エラー状態への遷移、再試行、待機状態等）が全く示されていません。要件全体や共通仕様、前提条件、他セクションでもこのタイムアウトに対する遷移先や復帰フローは記載されていないため、AGV が Loading 状態からデッドエンドになるリスクがあります。したがって、指摘は有効と判断します。
- **引用**: 
> タイムアウト時: - 60秒以内に積載が完了しない場合、ブザーを鳴らしてオペレータに通知する

#### [chk_14] タイムアウト時: 60秒以内に降載が完了しない場合、ブザーを...
- **理由**: 降載中からの遷移先が示されていないため、状態が抜け出せない可能性がある（Dead End）。
- **詳細分析**: 『降載中 (Unloading)』の状態遷移規則には「降載完了時 → 待機 (Idle)」と「タイムアウト時 → ブザーを鳴らしてオペレータに通知する」だけが記載されている。タイムアウト後の次状態（例：Error への遷移、再試行、または Idle への復帰）が明示されておらず、他のセクション（共通仕様、エラー処理、復帰ロジック）でもタイムアウトに対するデフォルトの遷移は定義されていない。そのため、タイムアウトが発生した場合に AGV が状態から抜け出せず、デッドエンドになる可能性がある。指摘は妥当であり、要件定義書に対する修正が必要である。
- **引用**: 
> 2. **タイムアウト時**:    - 60秒以内に降載が完了しない場合、ブザーを鳴らしてオペレータに通知する

#### [chk_15] 充電完了時: バッテリー残量が95%以上になると、充電を停止...
- **理由**: 充電完了後の遷移先が記載されておらず、Charging 状態からの抜け道が不明（Dead End）。
- **詳細分析**: 要件定義書全体を精査した結果、充電完了時の遷移先が明示的に記載されていないことが確認できました。3.2.5 充電中 (Charging) からの遷移規則では「バッテリー残量が95%以上になると、充電を停止する」だけが示されており、停止後にどの状態（Idle、Running、または別の状態）へ遷移するかの記述がありません。共通仕様・前提条件・他セクションでもこのケースをカバーする記述は見当たらず、業界標準でも充電完了後は通常「待機 (Idle)」や「走行中 (Running)」へ遷移する旨が明記されることが期待されますが、本書では欠落しています。したがって、指摘は有効（Dead End）と判断します。
- **引用**: 
> - **充電完了時**:    - バッテリー残量が95%以上になると、充電を停止する

#### [chk_24] 手動復帰必要エラー時: エラーコードがE011以上の場合、オ...
- **理由**: Error 状態からの遷移先が記載されておらず、ユーザーが状態から抜け出す手段が示されていない（Dead End）。
- **詳細分析**: 指摘は有効です。『エラー (Error)』状態の遷移規則(3.2.9)では、手動復帰が必要なエラーコード(E011 以上)について『LED表示灯を赤点滅にする』と記載されていますが、復帰先状態（例: Idle、Running、または他の状態）や手動復帰後にどのように状態遷移すべきかが一切記述されていません。文書全体を検索しても、手動復帰が必要なエラーからの遷移先や復帰手順を示すセクションは存在しません。したがって、AGV がエラー状態から抜け出す手段が不明であり、Dead End の指摘は正当です。
- **引用**: 
> <!--  【意図的な欠陥: Dead End #1】 手動復帰必要エラー時の「復帰先」が記載されていない。 オペレータが何をすればエラー状態から抜け出せるのか不明。 -->

#### [chk_26] 充電ドックが長時間空かない場合の対処が記載されていない。...
- **理由**: ChargeQueue 状態で外部への遷移が 1 つだけしか定義されておらず、他のシナリオでの遷移が欠如している（Dead End の可能性）。
- **詳細分析**: 要件定義書全体を精査した結果、ChargeQueue (充電待ち) 状態に関する記述は 3.2.10 のみで「充電ドックが空くと走行中 (Running) に遷移する」としか定義されていません。共通仕様・前提条件・他セクション・業界慣例のいずれにも、充電ドックが長時間占有され続けた場合のタイムアウト、代替経路、またはエラー遷移等のハンドリングは記載されていません。したがって、AGV が無限に待ち続ける可能性が残り、指摘された「Dead End #2」は実際に存在する欠陥と判断されます。
- **引用**: 
> <!--  【意図的な欠陥: Dead End #2】 充電ドックが長時間空かない場合の対処が記載されていない。 AGVは無限に待ち続ける可能性がある。 -->

#### [chk_30] シャットダウン状態からの復帰方法が記載されていない。...
- **理由**: Shutdown 状態に遷移はあるが、そこからの遷移先が記載されていないため Dead End。
- **詳細分析**: 要件定義書全体を精査した結果、Shutdown (S13) への遷移は 3.2.11 LowBattery に記載されているものの、Shutdown からの復帰に関する記述はどの節にも見当たらない。共通仕様、前提条件、別セクション、業界標準として暗黙的に復帰が行われる旨の記述もなく、Shutdown は実質的に終端状態 (Dead End) とみなせる。したがって、指摘「シャットダウン状態からの復帰方法が記載されていない」は正当であり、指摘は有効と判断する。
- **引用**: 
> 【意図的な欠陥: Dead End #3】 シャットダウン状態からの復帰方法が記載されていない。バッテリーを充電しても、どうやって再起動するのか不明。

#### [chk_31] 診断完了時: 結果を中央サーバーに送信する...
- **理由**: Diagnostic 状態からの遷移先が示されておらず、状態から抜け出す手段が不明（Dead End）。
- **詳細分析**: 要件定義書全体を精査した結果、診断モード (S15) の動作は 3.2.12 に記述されているものの、診断モードへ遷移する手段や条件はどのセクションにも記載されていない。共通仕様・前提条件や他セクション（メンテナンス、エラー、デバッグ、オペレータコンソール等）でも、診断モードへのエントリが暗黙的に定義されている形跡はなく、業界標準でも特別な自動遷移は想定されない。したがって「診断モードへの遷移方法が記載されていない」という指摘は正当であり、指摘を無効化できる根拠は見つからなかった。
- **引用**: 
> 【意図的な欠陥: Orphan State #1】 診断モードへの遷移方法が記載されていない。 この状態に入る手段が不明。

#### [chk_32] 診断モードへの遷移方法が記載されていない。...
- **理由**: 他の状態から Diagnostic へ遷移する記述がなく、状態に入れない（Orphan State）ため、実質的に遷移できない状態となっている。
- **詳細分析**: 要件定義書全体を精査した結果、診断モード（S15）への遷移手順はどのセクションにも記載されていない。状態遷移規則の各項目（3.2.1〜3.2.12）でも診断モードへの入口が示されておらず、共通仕様や前提条件でも暗黙的にカバーされる記述はない。したがって、本指摘『診断モードへの遷移方法が記載されていない』は正当であり、Orphan State の欠陥は有効と判断できる。
- **引用**: 
> <!--  【意図的な欠陥: Orphan State #1】 診断モードへの遷移方法が記載されていない。 この状態に入る手段が不明。 -->

#### [chk_33] 自動復帰中 (Recovering) の状態遷移が記載されて...
- **理由**: Recovering 状態に入ることはできても、そこからの遷移先が定義されていないため Dead End。
- **詳細分析**: 要件定義書全体を精査した結果、状態遷移規則のいずれのセクションにも「自動復帰中 (Recovering)」からの遷移先が記載されていない。3.2.9 ではエラーコード E001〜E010 の場合に Recovering へ遷移することは規定されているが、その後の復帰先（例: 前回の状態へ戻る、Idle へ遷移する等）は共通仕様・前提条件・他セクションでも言及されていない。したがって、Recovering 状態は定義された入口はあるものの出口が欠如しており、Dead End としての指摘は正当である。
- **引用**: 
> 1. **自動復帰可能エラー時**:    - エラーコードがE001〜E010の場合、「自動復帰中 (Recovering)」に遷移する

### 2 Missing Else

#### [chk_002] 磁気テープ逸脱時: 逸脱を検知すると、即座に停止する...
- **理由**: 逸脱後の復帰処理が記載されていない。停止後にどのように走行を再開するか、もしくはエラーに遷移するかの条件が未定義。
- **詳細分析**: 要件定義書全体を精査した結果、磁気テープ逸脱時の復帰処理はどのセクションにも記載がなく、以下の点から指摘は妥当と判断できる。
1. **共通仕様・前提条件**で磁気テープ逸脱後の動作は言及されていない。
2. **状態遷移表**では『逸脱検知 → 即座に停止』のみが記載され、復帰先状態（例：Obstacle → Running、または Error → Recovering）への遷移条件が欠如している。
3. **障害物停止 (Obstacle)** の復帰ロジックは障害物除去時に走行再開とあるが、磁気テープ逸脱は障害物として扱われる旨の記述が無く、別個のハンドリングが必要であることが暗黙的にも示唆されていない。
4. **エラー処理**や **自動復帰中 (Recovering)** 状態はエラーコードに基づく遷移として定義されているが、逸脱はエラーコードとして列挙されておらず、エラー遷移の根拠がない。
以上より、逸脱後の復帰処理が未定義であることは明らかな欠陥であり、指摘は正当であると結論付けた。
- **引用**: 
> 1. **磁気テープ逸脱時**:    - 逸脱を検知すると、即座に停止する

#### [chk_003] 側方障害物検知時: 超音波センサーで障害物を検知...
- **理由**: 側方障害物が検知された場合の対策（減速、停止、回避など）が記述されていない。検知後の動作が未定義。
- **詳細分析**: 要件定義書全体を精査した結果、側方障害物（超音波センサー）を検知した際の具体的な対策（減速、停止、回避走行など）が記述されている箇所は存在しない。前方障害物に対する動作は『障害物停止 (Obstacle)』状態や『走行制御 → 衝突回避 → 前方障害物検知時』で定義されているが、側方障害物に関しては 6.3『側方障害物検知時: 超音波センサーで障害物を検知』と記載されるのみで、後続の処理や状態遷移が示されていない。したがって、指摘は正当であり、誤りである可能性はなし。
- **引用**: 
> 2. 側方障害物検知時:    - 超音波センサーで障害物を検知

#### [chk_004] リフト上昇: 積載ステーション到達時にリフトを上昇させる...
- **理由**: 上昇後にリフトを下降させる条件や、エラー・タスクキャンセル時のリフト状態が記載されていない。
- **詳細分析**: 要件定義書全体を精査した結果、リフトの上昇後にいつ下降させるか、エラー発生時やタスクキャンセル時のリフトの状態については、どのセクションにも明示的な記述がない。共通仕様・前提条件でも言及がなく、別セクション（例: 状態遷移規則やリフト安全機構）でもリフトの復帰・停止後の処置は記載されていない。したがって、指摘された『上昇後にリフトを下降させる条件や、エラー・タスクキャンセル時のリフト状態が記載されていない』という問題は実際に存在し、指摘は正当である。
- **引用**: 
> <!--  【意図的な欠陥: Unstated Side Effects #1】 リフトを上昇させた後、いつ下降させるかの条件が不完全。 降載ステーションでは下降するが、エラー発生時やタスクキャンセル時のリフト状態が不明。 -->

#### [chk_005] リフト上昇中の障害物検知: リフト上部に障害物を検知すると、...
- **理由**: 上昇停止後の処理（再試行、逆方向移動、エラー遷移など）が定義されていない。
- **詳細分析**: 要件定義書全体を精査した結果、リフト上昇・下降中に障害物を検知した際の停止動作は「7.2 安全機構」にて"上昇を停止する"、"下降を停止する"と記載されていますが、停止後の復帰手順（再試行、逆方向移動、エラー遷移、オペレータ通知等）はどのセクションにも記載がありません。

- **共通仕様・前提条件**: いずれもリフトの障害物検知後の処理について触れていない。
- **別セクション**: 「3.2.6 障害物停止 (Obstacle)」は走行中の障害物に対する処理であり、リフト機構には適用されない。また、エラーや復帰に関する規定（3.2.9, 12.1, 12.2）もリフト停止をトリガーとしたケースを想定していない。
- **業界標準・暗黙のルール**: 通常は障害物検知後にリフトを停止し、手動確認や自動再試行の手順が必要とされるが、本文中に明示されていない。

以上より、指摘された「リフト上昇後の処理（再試行、逆方向移動、エラー遷移など）が定義されていない」という指摘は正当であり、要件定義書に該当項目が存在しないため、指摘は有効と判断します。
- **引用**: 
> 1. **リフト上昇中の障害物検知**:    - リフト上部に障害物を検知すると、上昇を停止する

#### [chk_006] モーター温度が80℃を超えると、「一時停止 (Paused)...
- **理由**: 温度が80℃以下のときに冷却ファンがどのように制御されるか（常時オン、必要時オン、オフ）といった条件が示されていない。
- **詳細分析**: 要件定義書全体を精査した結果、モーター温度が80℃以下の場合の冷却ファンの動作については、共通仕様・前提条件・他セクションのいずれにも記載がなく、業界標準でも『常時オン』『必要時オン』のいずれかを自動的に前提とする記述は見当たりません。したがって、【意図的な欠陥: Missing Else #5】で指摘された「80℃以下でのファン制御が未定義」という指摘は正当であり、指摘は有効です。
- **引用**: 
> 【意図的な欠陥: Missing Else #5】モーター温度が80℃以下の場合の冷却ファン動作が不明。常時稼働なのか、条件動作なのか未定義。

#### [chk_008] タスクキャンセル時、AGVは現在位置で停止する...
- **理由**: 積載中にキャンセルされた場合、荷物をどう扱うか（そのまま保持、降載、別の処理）が未定義。
- **詳細分析**: 要件定義書全体を精査した結果、タスクキャンセル時の荷物取り扱いについてはどのセクションでも明示的に記載がなく、共通仕様や前提条件、他の状態遷移・安全機能にも暗黙の取り決めは見られません。したがって、指摘された『積載中にキャンセルされた場合の荷物の扱いが未定義』という欠陥は実際に存在し、指摘は有効と判断されます。
- **引用**: 
> 【意図的な欠陥: Unstated Side Effects #4】タスクキャンセル時、積載中の荷物をどうするか記載がない。荷物を積んだまま停止するのか、降載するのか不明。

#### [chk_010] 診断モード (Diagnostic) での動作: 診断項目…...
- **理由**: 診断モードへ遷移する条件やトリガが記述されていない。診断モードに入る方法が未定義。
- **詳細分析**: 要件定義書全体を精査した結果、診断モード (Diagnostic) の状態遷移ルールは 3.2.12 節で「診断項目」や「診断完了時」の動作は記載されているものの、診断モードへ遷移するトリガや条件がどのセクションにも記載されていない。共通仕様・前提条件・他の状態遷移（例: メンテナンス完了時に自己診断を実行するが、診断モードへ遷移する旨は記載されず）でも同様に欠如している。したがって、指摘「診断モードへの遷移方法が記載されていない」は妥当であり、指摘は有効と判断された。
- **引用**: 
> <!--  【意図的な欠陥: Orphan State #1】 診断モードへの遷移方法が記載されていない。 この状態に入る手段が不明。 -->

#### [chk_1] 同時稼働AGV台数: 最大50台...
- **理由**: 「AGV台数が50台を超える」場合の動作（例: 受け付け拒否、警告表示等）が仕様書に記載されていないため、条件の網羅漏れ（Missing Else）がある。
- **詳細分析**: 要件定義書の『13.1 運用制約』で同時稼働AGV台数は最大50台と記載されているが、50台を超えた場合のシステム挙動（例: 受け付け拒否、警告表示、エラーコードの発行等）についてはどのセクションにも記述がない。共通仕様や前提条件、別セクションでもこのケースをカバーする記述は見当たらず、業界標準でも必須とされる明示的なハンドリングは規定されていない。したがって『Missing Else』の指摘は妥当であり、指摘は有効と判断する。
- **引用**: 
> 1. 同時稼働AGV台数: 最大50台

#### [chk_5] 動作温度範囲: 5℃〜40℃...
- **理由**: 温度が5℃未満または40℃超の場合の対策（停止、警告、保護モード等）が明示されていない。条件網羅が欠けている。
- **詳細分析**: 要件定義書全体を精査した結果、環境制約（13.2）で「動作温度範囲: 5℃〜40℃」と記載されているものの、温度が5℃未満または40℃超のケースに対する具体的な対策（停止、警告、保護モードへの遷移等）はどの節にも記載されていない。共通仕様・前提条件・他セクション、あるいは業界標準として暗黙の取り決めが示されている箇所も見当たらないため、指摘は正当であり、欠陥として有効と判断した。
- **引用**: 
> 【意図的な欠陥: Missing Else #6】 温度範囲外（5℃未満または40℃超）の場合の動作が不明。 停止するのか、警告を出すのか、そのまま動くのか未定義。

#### [chk_6] 動作湿度範囲: 20%〜80%（結露なきこと）...
- **理由**: 湿度が20%未満または80%以上のときの動作が未定義。範囲外入力に対する処理が記述されていない。
- **詳細分析**: 要件定義書全体を精査した結果、湿度が20%未満または80%以上の場合の挙動は『環境制約 13.2』で「動作湿度範囲: 20%〜80%（結露なきこと）」としか記載されておらず、範囲外入力に対するエラーハンドリング、警告、または安全停止等の処理は他のセクション（共通仕様、前提条件、状態遷移、エラーコード等）にも記載がない。業界標準でも特別な規定はなく、明示的に定義すべき事項と解釈できるため、指摘は妥当である。したがって、指摘は有効として確定する。
- **引用**: 
> 動作湿度範囲: 20%〜80%（結露なきこと）

#### [chk_8] 連続稼働時間: 8時間以内（その後1時間の休止が必要）...
- **理由**: 8時間を超えて連続稼働した場合、または休止時間が取られなかった場合の処理（強制停止、警告、エラー生成等）が仕様に記載されていない。条件の逆側が未定義。
- **詳細分析**: 要件定義書の『13.3 連続稼働時間: 8時間以内（その後1時間の休止が必要）』は単なる制約事項として記載されていますが、8時間を超えて連続稼働した場合や休止時間が取られなかった場合の具体的な処理（強制停止、警告、エラー生成、状態遷移等）はどのセクションにも記載されていません。共通仕様・前提条件・他セクションの状態遷移・エラーコード等を調査しても該当する記述は見当たらず、暗黙の業界標準としての取り決めも本文中で示されていないため、指摘は正当です。したがって、指摘は有効と判定します。
- **引用**: 
> 連続稼働時間: 8時間以内（その後1時間の休止が必要）

### 3 Orphan States

#### [chk_1] テスト待機モードへの遷移方法が記載されていない。...
- **理由**: 「テスト待機モード (TestStandby)」の概要・機能・終了時は記述されているが、モードへ入る手段（入口）が文書内に示されていないため、Orphan State（孤立した機能）と判断された。
- **詳細分析**: 要件定義書全体を精査した結果、テスト待機モード (TestStandby) への遷移手段はどのセクションにも記載されていない。状態遷移規則（3.2.x）でも、TestStandby は一覧に現れるが入口に関する記述は欠如している。共通仕様・前提条件・他モード（診断モード、デバッグモード）への遷移に関する記述もなく、暗黙の業界慣習としても、テストモードに入る際は「物理スイッチ」「特定コマンド」等を明示すべきである。したがって、指摘は正当であり、Orphan State #3 は実際に存在する欠陥として確定できる。
- **引用**: 
> <!--  【意図的な欠陥: Orphan State #3】 テスト待機モードへの遷移方法が記載されていない。 どうやってこのモードに入るのか不明。 -->