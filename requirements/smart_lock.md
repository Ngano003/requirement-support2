# スマートロックシステム 要件定義書 (Draft v0.1)

## 1. システム概要
本システムは、住宅の玄関ドアに設置し、ユーザーが暗証番号（PIN）を入力することで施錠・解錠を行うスマートロック製品である。

## 2. 構成要素 (Entities)
- **ユーザー (User)**: 住人。PINを入力する。
- **コントローラー (Controller)**: メイン制御装置。
- **モーター (Motor)**: サムターンを物理的に回すアクチュエータ。
- **LED**: 状態表示用ランプ。
- **ブザー**: 音声通知用。

## 3. 機能要件

### 3.1 施錠・解錠機能
- **施錠待機状態 (Idle)**: 通常はこの状態である。LEDは消灯。
- **PIN入力**: ユーザーがPINを入力すると、コントローラーは認証を行う。
  - **認証成功**: コントローラーはモーターを「解錠方向」に駆動し、状態を「解錠済み (Unlocked)」にする。LEDは緑色に点灯する。
  - **認証失敗**: ブザーを「短音2回」鳴らし、待機状態に戻る。
- **自動施錠**: 「解錠済み」になってから **5秒** が経過すると、自動的にモーターを「施錠方向」に駆動し、待機状態に戻る。

### 3.2 不正入力防止
- **ロックアウト**: 認証に **3回連続** で失敗すると、システムは「セキュリティロック (Lockout)」状態に移行する。
  - この状態では一切の入力を受け付けない。LEDは赤色点滅する。
  - **5分** 経過すると、自動的に待機状態に復帰する。

### 3.3 電源管理
- **バッテリー監視**: 常時バッテリー電圧を監視する。
- **低電圧警告**: 電圧が **20%以下** になると、操作のたびにブザーを「長音1回」鳴らす。
- **シャットダウン**: 電圧が **0% (動作限界)** になると、システムは「停止 (Shutdown)」状態になる。

## 4. 制約事項 (Constraints)
- **応答時間**: PIN入力完了からモーター駆動開始まで **200ms以内** であること。
- **モーター駆動力**: サムターンを回すのに十分なトルク (2.0 Nm) を出力すること。

---
<!--
意図的に埋め込んだ欠陥:
1. Shutdown状態からの復帰条件が記載されていない (Dead End)。
2. Shutdown時に施錠されるのか解錠されるのか記載がない (Security Risk)。
3. 「低電圧警告」が独立した状態なのか、Idle状態の属性なのか曖昧。
4. 解錠中にバッテリー切れになった場合の挙動が不明。
-->
